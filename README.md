## Описание проекта

Заказчик производит несколько сотен различных товаров бытовой и промышленной химии, а затем продаёт эти товары через дилеров. Дилеры, в свою очередь, занимаются розничной продажей товаров в крупных сетях магазинов и на онлайн площадках.
Для оценки ситуации,  управления ценами и  бизнесом в целом, заказчик периодически собирает информацию о том, как дилеры продают их товар. Для этого они парсят сайты дилеров, а затем сопоставляют товары и цены.
Зачастую описание товаров на сайтах дилеров отличаются от того описания, что даёт заказчик. 

**Цель проекта** - разработка решения, которое отчасти автоматизирует процесс сопоставления товаров. Основная идея - предлагать несколько товаров заказчика, которые с наибольшей вероятностью соответствуют размечаемому товару дилера. 
Предлагается реализовать это решение, как онлайн сервис, открываемый в веб-браузере. Выбор наиболее вероятных подсказок делается методами машинного обучения.


## Распределение задачей в команде

**Анатолий Остапенко** - разработка baseline и функции унификации наименований, коммуникация с наставниками и общая координация

**Владимир Зотов** - подбор оптимальной модели для создания эмбеддингов, оптимизация функции унификации наименований, проведение экспериментов с иными параметрами

**Александр Диков** - подбор оптимальной модели для создания эмбеддингов, упаковка модели для backend-разработчиков, проведение экспериментов с иными параметрами

## Описание проделанной работы

1. Проведено исследование таблиц и их объединение по ключам.
2. Разработана функция для унификации наименований товаров на сайте Заказчика и на сайтах дилеров с использованием регулярных выражений.
3. Разработан baseline модели, который предусматривал:
   - создание эмбеддингов при помощи модели bert-base-multilingual-cased;
   - расчет косинусного расстояния между эмбеддингом наименования каждого продукта с сайта дилера и всеми уникальными наименованиями продуктов с сайта заказчика при помощи метода pdist() библиотеки scipy и ранжирование эмбеддингов в зависимости от рассчитанного расстояния;
   - предложение 5 вариантов продуктов с сайта заказчика с наименьшим косинусным расстоянием до целевого продукта с сайта дилера.
4. Оптимизация baseline путем подбора оптимальной модели для создания эмбеддингов (в итоге остановились на Sentence Transformer LaBSE (Language-agnostic BERT Sentence Embedding)) и доработки функции унификации наименований.
5. Упаковка решения в скрипт для backend-разработчиков.

## Используемая метрика качества

В качестве метрики использовали Recall at K, поскольку целью проекта является разработка ML-алгоритма, среди предлагаемых вариантов сопоставления которого всегда должен содержаться правильный вариант для разметки (независимо от количества предлагаемых вариантов для разметки).

## Инструкция для использования решения

#### Описание класса ProseptDescriptionSearcher

Класс `ProseptDescriptionSearcher` предназначен для поиска продукта в базе данных по описанию. Он использует `SentenceTransformer` для генерации векторных представлений описаний продуктов и выполняет поиск на основе косинусного расстояния.

#### Инициализация

Параметры:

1. number_of_matching: Количество вариантов сопоставления (стандартное количество - 5).
2. cache_embeddings_update: Позволяет кэшировать эмбеддинги продукции. Принимает значения True или False.


#### Сопоставление

Сопоставление происходит с помощью вызова функции match_product, после инициалзиции модели.
Запрос выглядит следующим образом:

```python 
query = {
    'target': {
        'product_name': 'Имя товара с сайта дилера'
    }
}

results = searcher.match_product(query, number_of_matching=3)
```

Функция возвращает `id` товара из базы данных Prosept.

```

